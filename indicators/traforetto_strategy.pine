// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © TRADERAGENT

//@version=6
indicator("Traforetto Strategy (Tactica Adversa)", overlay=true, max_lines_count=500, max_labels_count=500, max_boxes_count=100)

// ============================================================================
// ОПИСАНИЕ
// ============================================================================
// Стратегия Трафоретто основана на методологии "Tactica Adversa"
// Определяет тренды через геометрические модели расширения (МР)
// Использует Сакральную Точку (СТ) для оценки силы тренда
// Применяет Гексаграмму для прогноза точек 5 и 6

// ============================================================================
// НАСТРОЙКИ
// ============================================================================

// Основные настройки
pivotStrength = input.int(5, "Pivot Strength (для поиска экстремумов)", minval=1, maxval=20, group="Основные настройки")
showTrendLines = input.bool(true, "Показать линии тренда", group="Отображение")
showTargetLines = input.bool(true, "Показать линии целей", group="Отображение")
showSacredPoint = input.bool(true, "Показать Сакральную Точку (СТ)", group="Отображение")
showHexagram = input.bool(true, "Показать Гексаграмму", group="Отображение")
showLabels = input.bool(true, "Показать метки точек", group="Отображение")
showSignals = input.bool(true, "Показать сигналы входа", group="Отображение")

// Цветовые настройки
upTrendColor = input.color(color.new(color.green, 0), "Цвет восходящего тренда", group="Цвета")
downTrendColor = input.color(color.new(color.red, 0), "Цвет нисходящего тренда", group="Цвета")
sacredPointColor = input.color(color.new(color.purple, 0), "Цвет Сакральной Точки", group="Цвета")
hexagramColor = input.color(color.new(color.blue, 30), "Цвет Гексаграммы", group="Цвета")

// Настройки сигналов
minTrendStrengthRatio = input.float(0.8, "Минимальное соотношение силы тренда (СТ-1 / 1-3)", minval=0.1, maxval=2.0, step=0.1, group="Сигналы")
entryZonePercent = input.float(5.0, "Зона входа от линии тренда (%)", minval=0.5, maxval=20.0, step=0.5, group="Сигналы")

// ============================================================================
// ФУНКЦИИ ОПРЕДЕЛЕНИЯ ЭКСТРЕМУМОВ
// ============================================================================

// Функция для поиска pivot highs
f_pivotHigh(src, leftBars, rightBars) =>
    ta.pivothigh(src, leftBars, rightBars)

// Функция для поиска pivot lows
f_pivotLow(src, leftBars, rightBars) =>
    ta.pivotlow(src, leftBars, rightBars)

// ============================================================================
// ОПРЕДЕЛЕНИЕ ТОЧЕК МОДЕЛИ (1-6)
// ============================================================================

// Массивы для хранения точек
var array<float> point_prices = array.new<float>(7, na)  // 0-индекс не используем, 1-6 точки
var array<int> point_bars = array.new<int>(7, na)
var array<string> point_types = array.new<string>(7, "")  // "high" или "low"

// Переменные для отслеживания текущего тренда
var string currentTrend = "none"  // "up" или "down" или "none"
var int modelPointCount = 0  // Сколько точек модели уже найдено (0-6)

// Определение новых экстремумов
pivotHighValue = f_pivotHigh(high, pivotStrength, pivotStrength)
pivotLowValue = f_pivotLow(low, pivotStrength, pivotStrength)

// Логика определения последовательности точек
if not na(pivotHighValue) or not na(pivotLowValue)
    // Если модель еще не начата или завершена
    if modelPointCount == 0 or modelPointCount >= 6
        // Начинаем новую модель
        if not na(pivotLowValue)
            // Начало восходящего тренда с low1
            array.set(point_prices, 1, pivotLowValue)
            array.set(point_bars, 1, bar_index - pivotStrength)
            array.set(point_types, 1, "low")
            currentTrend := "up"
            modelPointCount := 1
        else if not na(pivotHighValue)
            // Начало нисходящего тренда с high1
            array.set(point_prices, 1, pivotHighValue)
            array.set(point_bars, 1, bar_index - pivotStrength)
            array.set(point_types, 1, "high")
            currentTrend := "down"
            modelPointCount := 1

    // Продолжаем существующую модель
    else if currentTrend == "up"
        // Восходящий тренд: low1 - high2 - low3 - high4 - low5 - high6
        if modelPointCount == 1 and not na(pivotHighValue)
            // Ищем high2
            array.set(point_prices, 2, pivotHighValue)
            array.set(point_bars, 2, bar_index - pivotStrength)
            array.set(point_types, 2, "high")
            modelPointCount := 2
        else if modelPointCount == 2 and not na(pivotLowValue)
            // Ищем low3
            array.set(point_prices, 3, pivotLowValue)
            array.set(point_bars, 3, bar_index - pivotStrength)
            array.set(point_types, 3, "low")
            modelPointCount := 3
        else if modelPointCount == 3 and not na(pivotHighValue)
            // Ищем high4
            array.set(point_prices, 4, pivotHighValue)
            array.set(point_bars, 4, bar_index - pivotStrength)
            array.set(point_types, 4, "high")
            modelPointCount := 4
        else if modelPointCount == 4 and not na(pivotLowValue)
            // Ищем low5
            array.set(point_prices, 5, pivotLowValue)
            array.set(point_bars, 5, bar_index - pivotStrength)
            array.set(point_types, 5, "low")
            modelPointCount := 5
        else if modelPointCount == 5 and not na(pivotHighValue)
            // Ищем high6
            array.set(point_prices, 6, pivotHighValue)
            array.set(point_bars, 6, bar_index - pivotStrength)
            array.set(point_types, 6, "high")
            modelPointCount := 6

    else if currentTrend == "down"
        // Нисходящий тренд: high1 - low2 - high3 - low4 - high5 - low6
        if modelPointCount == 1 and not na(pivotLowValue)
            // Ищем low2
            array.set(point_prices, 2, pivotLowValue)
            array.set(point_bars, 2, bar_index - pivotStrength)
            array.set(point_types, 2, "low")
            modelPointCount := 2
        else if modelPointCount == 2 and not na(pivotHighValue)
            // Ищем high3
            array.set(point_prices, 3, pivotHighValue)
            array.set(point_bars, 3, bar_index - pivotStrength)
            array.set(point_types, 3, "high")
            modelPointCount := 3
        else if modelPointCount == 3 and not na(pivotLowValue)
            // Ищем low4
            array.set(point_prices, 4, pivotLowValue)
            array.set(point_bars, 4, bar_index - pivotStrength)
            array.set(point_types, 4, "low")
            modelPointCount := 4
        else if modelPointCount == 4 and not na(pivotHighValue)
            // Ищем high5
            array.set(point_prices, 5, pivotHighValue)
            array.set(point_bars, 5, bar_index - pivotStrength)
            array.set(point_types, 5, "high")
            modelPointCount := 5
        else if modelPointCount == 5 and not na(pivotLowValue)
            // Ищем low6
            array.set(point_prices, 6, pivotLowValue)
            array.set(point_bars, 6, bar_index - pivotStrength)
            array.set(point_types, 6, "low")
            modelPointCount := 6

// ============================================================================
// РАСЧЕТ САКРАЛЬНОЙ ТОЧКИ (СТ) И СИЛЫ ТРЕНДА
// ============================================================================

// Функция для вычисления точки пересечения двух линий
f_lineIntersection(x1, y1, x2, y2, x3, y3, x4, y4) =>
    var float xIntersect = na
    var float yIntersect = na

    // Вычисляем наклоны
    denom = (x1 - x2) * (y3 - y4) - (y1 - y2) * (x3 - x4)

    if math.abs(denom) > 0.0000001  // Линии не параллельны
        xIntersect := ((x1 * y2 - y1 * x2) * (x3 - x4) - (x1 - x2) * (x3 * y4 - y3 * x4)) / denom
        yIntersect := ((x1 * y2 - y1 * x2) * (y3 - y4) - (y1 - y2) * (x3 * y4 - y3 * x4)) / denom

    [xIntersect, yIntersect]

var float sacredPointX = na
var float sacredPointY = na
var float trendStrength = na
var bool isStrongTrend = false

// Вычисляем СТ только когда есть хотя бы 4 точки
if modelPointCount >= 4
    p1_bar = array.get(point_bars, 1)
    p1_price = array.get(point_prices, 1)
    p2_bar = array.get(point_bars, 2)
    p2_price = array.get(point_prices, 2)
    p3_bar = array.get(point_bars, 3)
    p3_price = array.get(point_prices, 3)
    p4_bar = array.get(point_bars, 4)
    p4_price = array.get(point_prices, 4)

    if not na(p1_bar) and not na(p2_bar) and not na(p3_bar) and not na(p4_bar)
        // Линия тренда: точки 1-3
        // Линия целей: точки 2-4
        [stX, stY] = f_lineIntersection(p1_bar, p1_price, p3_bar, p3_price,
                                         p2_bar, p2_price, p4_bar, p4_price)

        sacredPointX := stX
        sacredPointY := stY

        // Оценка силы тренда: отношение СТ-1 к 1-3
        if not na(stX)
            distST1 = math.abs(p1_bar - stX)
            dist13 = math.abs(p3_bar - p1_bar)

            if dist13 > 0
                trendStrength := distST1 / dist13
                // Сильный тренд если СТ-1 < 1-3, т.е. ratio < 1
                isStrongTrend := trendStrength < minTrendStrengthRatio

// ============================================================================
// ГЕКСАГРАММА - ПРОГНОЗ ТОЧЕК 5 И 6
// ============================================================================

var float hexagramPointAX = na
var float hexagramPointAY = na
var float hexagramPointBX = na
var float hexagramPointBY = na
var float hexagramPointCX = na
var float hexagramPointCY = na

// Вычисляем гексаграмму когда есть 4 точки и СТ
if modelPointCount >= 4 and not na(sacredPointX) and not na(sacredPointY)
    p1_bar = array.get(point_bars, 1)
    p1_price = array.get(point_prices, 1)
    p2_bar = array.get(point_bars, 2)
    p2_price = array.get(point_prices, 2)
    p3_bar = array.get(point_bars, 3)
    p3_price = array.get(point_prices, 3)
    p4_bar = array.get(point_bars, 4)
    p4_price = array.get(point_prices, 4)

    if not na(p1_bar) and not na(p2_bar) and not na(p3_bar) and not na(p4_bar)
        // Середина отрезка 3-4
        mid34X = (p3_bar + p4_bar) / 2
        mid34Y = (p3_price + p4_price) / 2

        // Точка C: продление от СТ через середину 3-4
        // Расстояние от СТ до середины 3-4
        distX = mid34X - sacredPointX
        distY = mid34Y - sacredPointY

        // Точка C на том же расстоянии от середины
        hexagramPointCX := mid34X + distX
        hexagramPointCY := mid34Y + distY

        // Точка A: пересечение линии (2 - середина 3-4) с линией (3 - C)
        [aX, aY] = f_lineIntersection(p2_bar, p2_price, mid34X, mid34Y,
                                       p3_bar, p3_price, hexagramPointCX, hexagramPointCY)
        hexagramPointAX := aX
        hexagramPointAY := aY

        // Точка B: пересечение линии (1 - середина 3-4) с линией (4 - C)
        [bX, bY] = f_lineIntersection(p1_bar, p1_price, mid34X, mid34Y,
                                       p4_bar, p4_price, hexagramPointCX, hexagramPointCY)
        hexagramPointBX := bX
        hexagramPointBY := bY

// ============================================================================
// ОПРЕДЕЛЕНИЕ СИГНАЛОВ ВХОДА
// ============================================================================

var bool longSignal = false
var bool shortSignal = false

// Сигнал на LONG
if currentTrend == "up" and modelPointCount >= 3 and isStrongTrend
    p3_price = array.get(point_prices, 3)
    p1_price = array.get(point_prices, 1)
    p1_bar = array.get(point_bars, 1)
    p3_bar = array.get(point_bars, 3)

    if not na(p3_price) and not na(p1_price)
        // Линия тренда на текущем баре
        trendLineSlope = (p3_price - p1_price) / (p3_bar - p1_bar)
        trendLinePrice = p3_price + trendLineSlope * (bar_index - p3_bar)

        // Зона входа
        entryZone = trendLinePrice * (entryZonePercent / 100)

        // Проверка: цена коснулась или приближается к линии тренда
        if close >= trendLinePrice - entryZone and close <= trendLinePrice + entryZone
            longSignal := true
        else
            longSignal := false
    else
        longSignal := false
else
    longSignal := false

// Сигнал на SHORT
if currentTrend == "down" and modelPointCount >= 3 and isStrongTrend
    p3_price = array.get(point_prices, 3)
    p1_price = array.get(point_prices, 1)
    p1_bar = array.get(point_bars, 1)
    p3_bar = array.get(point_bars, 3)

    if not na(p3_price) and not na(p1_price)
        // Линия тренда на текущем баре
        trendLineSlope = (p3_price - p1_price) / (p3_bar - p1_bar)
        trendLinePrice = p3_price + trendLineSlope * (bar_index - p3_bar)

        // Зона входа
        entryZone = trendLinePrice * (entryZonePercent / 100)

        // Проверка: цена коснулась или приближается к линии тренда
        if close <= trendLinePrice + entryZone and close >= trendLinePrice - entryZone
            shortSignal := true
        else
            shortSignal := false
    else
        shortSignal := false
else
    shortSignal := false

// ============================================================================
// ВИЗУАЛИЗАЦИЯ
// ============================================================================

// Удаление старых линий и меток
var line trendLine = na
var line targetLine = na
var line sacredPointLineH = na
var line sacredPointLineV = na
var label sacredPointLabel = na
var line hexagramLine1 = na
var line hexagramLine2 = na
var line hexagramLine3 = na
var line hexagramLine4 = na
var line hexagramLine5 = na
var label pointLabel1 = na
var label pointLabel2 = na
var label pointLabel3 = na
var label pointLabel4 = na
var label pointLabel5 = na
var label pointLabel6 = na
var label hexagramLabelA = na
var label hexagramLabelB = na

// Рисуем модель если есть хотя бы 4 точки
if modelPointCount >= 4
    p1_bar = array.get(point_bars, 1)
    p1_price = array.get(point_prices, 1)
    p2_bar = array.get(point_bars, 2)
    p2_price = array.get(point_prices, 2)
    p3_bar = array.get(point_bars, 3)
    p3_price = array.get(point_prices, 3)
    p4_bar = array.get(point_bars, 4)
    p4_price = array.get(point_prices, 4)

    if not na(p1_bar) and not na(p2_bar) and not na(p3_bar) and not na(p4_bar)
        trendColor = currentTrend == "up" ? upTrendColor : downTrendColor

        // Линия тренда (1-3)
        if showTrendLines
            if not na(trendLine)
                line.delete(trendLine)
            trendLine := line.new(p1_bar, p1_price, p3_bar, p3_price,
                                  color=trendColor, width=2, style=line.style_solid,
                                  extend=extend.right)

        // Линия целей (2-4)
        if showTargetLines
            if not na(targetLine)
                line.delete(targetLine)
            targetLine := line.new(p2_bar, p2_price, p4_bar, p4_price,
                                   color=trendColor, width=2, style=line.style_dashed,
                                   extend=extend.right)

        // Сакральная точка
        if showSacredPoint and not na(sacredPointX) and not na(sacredPointY)
            if not na(sacredPointLineH)
                line.delete(sacredPointLineH)
            if not na(sacredPointLineV)
                line.delete(sacredPointLineV)
            if not na(sacredPointLabel)
                label.delete(sacredPointLabel)

            // Крестик в точке СТ
            sacredPointLineH := line.new(sacredPointX - 2, sacredPointY, sacredPointX + 2, sacredPointY,
                                         color=sacredPointColor, width=3)
            sacredPointLineV := line.new(sacredPointX, sacredPointY - (p2_price - p1_price) * 0.02,
                                         sacredPointX, sacredPointY + (p2_price - p1_price) * 0.02,
                                         color=sacredPointColor, width=3)

            strengthText = isStrongTrend ? "СИЛЬНЫЙ" : "СЛАБЫЙ"
            sacredPointLabel := label.new(sacredPointX, sacredPointY,
                                          "СТ\n" + strengthText + "\n" + str.tostring(trendStrength, "#.##"),
                                          color=color.new(sacredPointColor, 70),
                                          textcolor=color.white,
                                          style=label.style_label_center,
                                          size=size.small)

        // Метки точек
        if showLabels
            if not na(pointLabel1)
                label.delete(pointLabel1)
            if not na(pointLabel2)
                label.delete(pointLabel2)
            if not na(pointLabel3)
                label.delete(pointLabel3)
            if not na(pointLabel4)
                label.delete(pointLabel4)

            pointLabel1 := label.new(p1_bar, p1_price, "1",
                                     color=color.new(trendColor, 70),
                                     textcolor=color.white,
                                     style=currentTrend == "up" ? label.style_label_up : label.style_label_down,
                                     size=size.normal)

            pointLabel2 := label.new(p2_bar, p2_price, "2",
                                     color=color.new(trendColor, 70),
                                     textcolor=color.white,
                                     style=currentTrend == "up" ? label.style_label_down : label.style_label_up,
                                     size=size.normal)

            pointLabel3 := label.new(p3_bar, p3_price, "3",
                                     color=color.new(trendColor, 70),
                                     textcolor=color.white,
                                     style=currentTrend == "up" ? label.style_label_up : label.style_label_down,
                                     size=size.normal)

            pointLabel4 := label.new(p4_bar, p4_price, "4",
                                     color=color.new(trendColor, 70),
                                     textcolor=color.white,
                                     style=currentTrend == "up" ? label.style_label_down : label.style_label_up,
                                     size=size.normal)

        // Точки 5 и 6 если есть
        if modelPointCount >= 5
            p5_bar = array.get(point_bars, 5)
            p5_price = array.get(point_prices, 5)

            if not na(p5_bar) and not na(p5_price) and showLabels
                if not na(pointLabel5)
                    label.delete(pointLabel5)
                pointLabel5 := label.new(p5_bar, p5_price, "5",
                                         color=color.new(trendColor, 70),
                                         textcolor=color.white,
                                         style=currentTrend == "up" ? label.style_label_up : label.style_label_down,
                                         size=size.normal)

        if modelPointCount >= 6
            p6_bar = array.get(point_bars, 6)
            p6_price = array.get(point_prices, 6)

            if not na(p6_bar) and not na(p6_price) and showLabels
                if not na(pointLabel6)
                    label.delete(pointLabel6)
                pointLabel6 := label.new(p6_bar, p6_price, "6",
                                         color=color.new(trendColor, 70),
                                         textcolor=color.white,
                                         style=currentTrend == "up" ? label.style_label_down : label.style_label_up,
                                         size=size.normal)

// Рисуем Гексаграмму
if showHexagram and not na(hexagramPointAX) and not na(hexagramPointBX) and not na(hexagramPointCX)
    p3_bar = array.get(point_bars, 3)
    p3_price = array.get(point_prices, 3)
    p4_bar = array.get(point_bars, 4)
    p4_price = array.get(point_prices, 4)

    if not na(p3_bar) and not na(p4_bar)
        if not na(hexagramLine1)
            line.delete(hexagramLine1)
        if not na(hexagramLine2)
            line.delete(hexagramLine2)
        if not na(hexagramLine3)
            line.delete(hexagramLine3)
        if not na(hexagramLine4)
            line.delete(hexagramLine4)
        if not na(hexagramLine5)
            line.delete(hexagramLine5)
        if not na(hexagramLabelA)
            label.delete(hexagramLabelA)
        if not na(hexagramLabelB)
            label.delete(hexagramLabelB)

        // Линии гексаграммы
        // 3-4
        hexagramLine1 := line.new(p3_bar, p3_price, p4_bar, p4_price,
                                  color=hexagramColor, width=1, style=line.style_dotted)

        // 3-C
        hexagramLine2 := line.new(p3_bar, p3_price, hexagramPointCX, hexagramPointCY,
                                  color=hexagramColor, width=1, style=line.style_dotted)

        // 4-C
        hexagramLine3 := line.new(p4_bar, p4_price, hexagramPointCX, hexagramPointCY,
                                  color=hexagramColor, width=1, style=line.style_dotted)

        // СТ - середина 3-4 - C
        mid34X = (p3_bar + p4_bar) / 2
        mid34Y = (p3_price + p4_price) / 2
        hexagramLine4 := line.new(sacredPointX, sacredPointY, hexagramPointCX, hexagramPointCY,
                                  color=hexagramColor, width=1, style=line.style_dotted)

        // Метки прогнозных точек A и B
        if showLabels
            hexagramLabelA := label.new(hexagramPointAX, hexagramPointAY, "A (прогноз 5)",
                                        color=color.new(color.blue, 70),
                                        textcolor=color.white,
                                        style=label.style_label_center,
                                        size=size.small)

            hexagramLabelB := label.new(hexagramPointBX, hexagramPointBY, "B (прогноз 6)",
                                        color=color.new(color.blue, 70),
                                        textcolor=color.white,
                                        style=label.style_label_center,
                                        size=size.small)

// ============================================================================
// ОТОБРАЖЕНИЕ СИГНАЛОВ
// ============================================================================

if showSignals
    plotshape(longSignal, title="LONG Signal",
              location=location.belowbar,
              color=color.new(color.green, 0),
              style=shape.triangleup,
              size=size.normal,
              text="LONG")

    plotshape(shortSignal, title="SHORT Signal",
              location=location.abovebar,
              color=color.new(color.red, 0),
              style=shape.triangledown,
              size=size.normal,
              text="SHORT")

// Подсветка фона при сигнале
bgcolor(longSignal ? color.new(color.green, 90) : na, title="LONG Background")
bgcolor(shortSignal ? color.new(color.red, 90) : na, title="SHORT Background")

// ============================================================================
// ИНФОРМАЦИОННАЯ ТАБЛИЦА
// ============================================================================

var table infoTable = table.new(position.top_right, 2, 7, border_width=1)

if barstate.islast
    // Заголовок
    table.cell(infoTable, 0, 0, "Параметр",
               bgcolor=color.new(color.gray, 50),
               text_color=color.white,
               text_size=size.normal)
    table.cell(infoTable, 1, 0, "Значение",
               bgcolor=color.new(color.gray, 50),
               text_color=color.white,
               text_size=size.normal)

    // Тренд
    table.cell(infoTable, 0, 1, "Тренд",
               bgcolor=color.new(color.gray, 70),
               text_color=color.white)
    trendText = currentTrend == "up" ? "ВОСХОДЯЩИЙ" : currentTrend == "down" ? "НИСХОДЯЩИЙ" : "НЕТ"
    trendBg = currentTrend == "up" ? color.new(color.green, 70) : currentTrend == "down" ? color.new(color.red, 70) : color.new(color.gray, 70)
    table.cell(infoTable, 1, 1, trendText,
               bgcolor=trendBg,
               text_color=color.white)

    // Количество точек
    table.cell(infoTable, 0, 2, "Точек модели",
               bgcolor=color.new(color.gray, 70),
               text_color=color.white)
    table.cell(infoTable, 1, 2, str.tostring(modelPointCount),
               bgcolor=color.new(color.blue, 70),
               text_color=color.white)

    // Сила тренда
    table.cell(infoTable, 0, 3, "Сила тренда",
               bgcolor=color.new(color.gray, 70),
               text_color=color.white)
    strengthText = not na(trendStrength) ? str.tostring(trendStrength, "#.##") : "N/A"
    strengthBg = isStrongTrend ? color.new(color.green, 70) : color.new(color.orange, 70)
    table.cell(infoTable, 1, 3, strengthText,
               bgcolor=strengthBg,
               text_color=color.white)

    // Тип тренда
    table.cell(infoTable, 0, 4, "Тип",
               bgcolor=color.new(color.gray, 70),
               text_color=color.white)
    typeText = isStrongTrend ? "СИЛЬНЫЙ" : "СЛАБЫЙ"
    table.cell(infoTable, 1, 4, typeText,
               bgcolor=strengthBg,
               text_color=color.white)

    // Прогноз точки 5
    table.cell(infoTable, 0, 5, "Прогноз точки 5",
               bgcolor=color.new(color.gray, 70),
               text_color=color.white)
    point5Text = not na(hexagramPointAY) ? str.tostring(hexagramPointAY, format.mintick) : "N/A"
    table.cell(infoTable, 1, 5, point5Text,
               bgcolor=color.new(color.blue, 70),
               text_color=color.white,
               text_size=size.small)

    // Прогноз точки 6
    table.cell(infoTable, 0, 6, "Прогноз точки 6",
               bgcolor=color.new(color.gray, 70),
               text_color=color.white)
    point6Text = not na(hexagramPointBY) ? str.tostring(hexagramPointBY, format.mintick) : "N/A"
    table.cell(infoTable, 1, 6, point6Text,
               bgcolor=color.new(color.blue, 70),
               text_color=color.white,
               text_size=size.small)

// ============================================================================
// АЛЕРТЫ
// ============================================================================

alertcondition(longSignal, title="Traforetto LONG Signal",
               message="Трафоретто: Сигнал на покупку (LONG). Восходящий тренд, цена у линии тренда.")

alertcondition(shortSignal, title="Traforetto SHORT Signal",
               message="Трафоретто: Сигнал на продажу (SHORT). Нисходящий тренд, цена у линии тренда.")

alertcondition(modelPointCount == 4, title="Traforetto Model Complete (4 points)",
               message="Трафоретто: Модель расширения сформирована (4 точки). Готова к торговле.")

alertcondition(modelPointCount == 6, title="Traforetto Model Complete (6 points)",
               message="Трафоретто: Модель расширения завершена (6 точек). Возможно начало новой модели.")
