# Universal Indicator - Автоматическое определение уровней Фибоначчи

## Обзор

**Universal Indicator** (Универсальный индикатор) - это система из двух индикаторов для TradingView, написанных на Pine Script v6, которая автоматически определяет ключевые свечи для построения уровней Фибоначчи на основе состояния множественных технических индикаторов.

## Компоненты системы

Система состоит из двух индикаторов:

1. **universal_indicator.pine** - Основной индикатор (overlay=false)
   - Отображается в отдельной панели под графиком цены
   - Показывает RSI, сглаженный RSI и объемный моментум
   - Визуализирует зоны перекупленности/перепроданности
   - Содержит отладочную таблицу с метриками

2. **universal_indicator_overlay.pine** - Наложение с уровнями Фибоначчи (overlay=true)
   - Отображается на основном графике цены
   - Рисует уровни Фибоначчи при появлении сигналов
   - Отмечает сигнальные свечи треугольниками
   - Подсвечивает сигнальные свечи цветом

## Логика работы индикатора

### Анализ исходной информации

На основе анализа предоставленных изображений и описаний индикаторов "Target on Trend - Lite" и "RSIV_Step", система определяет:

#### 1. Закономерность выставления уровней Фибоначчи

Уровни Фибоначчи выставляются относительно следующих состояний индикаторов:

- **Зелёные зоны** - область перепроданности (RSI < 30)
- **Красные/розовые зоны** - область перекупленности (RSI > 70)
- **Переходные моменты** - когда индикатор пересекает границы зон
- **Объёмный моментум** - подтверждение силы движения

#### 2. Причины выбора конкретных свечей

Свечи выбираются по следующим критериям:

**Зелёные свечи (бычий сигнал):**
- RSI пересекает уровень перепроданности снизу вверх (выход из oversold)
- Объёмный моментум превышает пороговое значение (подтверждение силы)
- Сглаженный RSI показывает восходящее движение
- Все три условия выполняются одновременно

**Красные свечи (медвежий сигнал):**
- RSI пересекает уровень перекупленности сверху вниз (выход из overbought)
- Объёмный моментум превышает пороговое значение
- Сглаженный RSI показывает нисходящее движение
- Все три условия выполняются одновременно

#### 3. Логика построения уровней Фибоначчи

**Для бычьих сигналов (зелёные свечи):**
- Определяется swing low (минимум) за период lookback
- Определяется swing high (максимум) за период lookback
- Уровни строятся от low к high (снизу вверх)
- Уровни: 0%, 23.6%, 38.2%, 50%, 61.8%, 78.6%, 100%

**Для медвежьих сигналов (красные свечи):**
- Определяется swing high (максимум) за период lookback
- Определяется swing low (минимум) за период lookback
- Уровни строятся от high к low (сверху вниз)
- Уровни: 0%, 23.6%, 38.2%, 50%, 61.8%, 78.6%, 100%

### Технические детали

#### Расчёт RSI
```pine
rsi = ta.rsi(close, rsiLength)          // Основной RSI
rsiSmooth = ta.sma(rsi, rsiSmoothLength) // Сглаженный RSI
```

#### Расчёт объёмного моментума
```pine
volumeMa = ta.sma(volume, volumeMaLength)
volumeMomentum = volume / volumeMa
```

#### Условия сигналов
```pine
// Бычий сигнал
bullishTransition = ta.crossover(rsi, rsiOversold)
rsiRising = rsiSmooth > rsiSmooth[1]
bullishSignal = bullishTransition and strongMomentum and rsiRising

// Медвежий сигнал
bearishTransition = ta.crossunder(rsi, rsiOverbought)
rsiFalling = rsiSmooth < rsiSmooth[1]
bearishSignal = bearishTransition and strongMomentum and rsiFalling
```

## Параметры настройки

### RSI Settings (Настройки RSI)
- **RSI Length** (Период RSI): 14 (по умолчанию)
- **RSI Smoothing Length** (Период сглаживания): 3
- **RSI Oversold Level** (Уровень перепроданности): 30
- **RSI Overbought Level** (Уровень перекупленности): 70

### Momentum Settings (Настройки моментума)
- **Volume MA Length** (Период MA объёма): 20
- **Momentum Threshold** (Порог моментума): 1.2

### Fibonacci Settings (Настройки Фибоначчи)
- **Fibonacci Lookback Period** (Период поиска swing точек): 100
- **Show Bullish/Bearish Fibonacci** (Показывать уровни): true

### Display Settings (Настройки отображения)
- **Show Bullish/Bearish Signals** (Показывать сигналы): true
- **Show Colored Zones** (Показывать цветные зоны): true
- **Show Level Labels** (Показывать метки уровней): true

## Установка и использование

### Шаг 1: Установка основного индикатора

1. Откройте TradingView и перейдите в Pine Editor
2. Создайте новый индикатор
3. Скопируйте код из `universal_indicator.pine`
4. Сохраните как "Universal Indicator"
5. Добавьте на график

### Шаг 2: Установка overlay индикатора

1. Создайте ещё один новый индикатор в Pine Editor
2. Скопируйте код из `universal_indicator_overlay.pine`
3. Сохраните как "Universal Indicator - Fibonacci Overlay"
4. Добавьте на тот же график

### Шаг 3: Настройка параметров

**ВАЖНО**: Параметры RSI и Momentum должны быть одинаковыми в обоих индикаторах!

1. Откройте настройки обоих индикаторов
2. Убедитесь, что следующие параметры совпадают:
   - RSI Length
   - RSI Smoothing Length
   - RSI Oversold Level
   - RSI Overbought Level
   - Volume MA Length
   - Momentum Threshold

## Интерпретация сигналов

### В панели индикатора (universal_indicator.pine)

1. **Синяя линия** - основной RSI
2. **Оранжевая линия** - сглаженный RSI
3. **Зелёная зона** - область перепроданности (oversold)
4. **Красная зона** - область перекупленности (overbought)
5. **Гистограмма** - объёмный моментум (зелёная = сильный)
6. **Треугольники** - сигналы покупки (вверх) и продажи (вниз)

### На графике цены (universal_indicator_overlay.pine)

1. **Зелёный треугольник вверх + "BUY"** - бычий сигнал
   - Свеча подсвечена зелёным
   - Уровни Фибоначчи построены от low к high

2. **Красный треугольник вниз + "SELL"** - медвежий сигнал
   - Свеча подсвечена красным
   - Уровни Фибоначчи построены от high к low

3. **Цветные линии** - уровни Фибоначчи:
   - Красная (толстая) - 0% и 100%
   - Оранжевая - 23.6%
   - Жёлтая - 38.2%
   - Синяя (толстая) - 50%
   - Зелёная (толстая) - 61.8%
   - Фиолетовая - 78.6%

### Отладочная таблица (Debug Table)

В правом верхнем углу панели индикатора:

- **RSI** - текущее значение RSI (цвет показывает состояние)
- **State** - состояние: Oversold / Overbought / Neutral
- **Vol Momentum** - текущий объёмный моментум
- **Last Bullish** - сколько баров назад был последний бычий сигнал
- **Last Bearish** - сколько баров назад был последний медвежий сигнал
- **Bullish Fib Range** - диапазон для бычьих уровней Фибоначчи
- **Bearish Fib Range** - диапазон для медвежьих уровней Фибоначчи

## Рекомендации по использованию

### Выбор таймфрейма

- **1H - 4H** - для краткосрочной торговли
- **1D** - для среднесрочной торговли (рекомендуется)
- **1W** - для долгосрочного анализа

### Выбор активов

Индикатор лучше всего работает на:
- Криптовалюты с высокой волатильностью (BTC, ETH, альткоины)
- Форекс пары с хорошей ликвидностью
- Акции с активной торговлей

### Стратегия торговли

#### Для бычьих сигналов:
1. **Вход**: При появлении зелёного треугольника
2. **Стоп-лосс**: Ниже уровня 0% Фибоначчи
3. **Цели прибыли**:
   - Первая цель: 38.2%
   - Вторая цель: 50%
   - Третья цель: 61.8%
   - Финальная цель: 100%

#### Для медвежьих сигналов:
1. **Вход**: При появлении красного треугольника
2. **Стоп-лосс**: Выше уровня 0% Фибоначчи
3. **Цели прибыли**: симметричны бычьим

### Дополнительные фильтры

Рекомендуется использовать индикатор в сочетании с:
- Трендовым анализом (старший таймфрейм)
- Уровнями поддержки/сопротивления
- Объёмным анализом
- Другими индикаторами подтверждения

## Настройка алертов

Оба индикатора поддерживают встроенные алерты:

1. Правый клик на графике → "Add Alert"
2. Выберите условие:
   - "Bullish Signal" - бычий сигнал
   - "Bearish Signal" - медвежий сигнал
3. Настройте параметры уведомлений
4. Создайте алерт

## Устранение проблем

### Сигналы не появляются

**Причина**: Условия для сигнала очень строгие - требуется одновременное выполнение всех трёх условий.

**Решение**:
1. Проверьте отладочную таблицу
2. Прокрутите исторические данные
3. Попробуйте более волатильные активы
4. Попробуйте разные таймфреймы
5. Временно измените порог RSI (например, 35 вместо 30)

### Уровни Фибоначчи не видны

**Причина**: Возможно, уровни находятся за пределами видимой области.

**Решение**:
1. Увеличьте вертикальный масштаб графика
2. Прокрутите к бару, где появился сигнал
3. Убедитесь, что в настройках включено "Show Fibonacci Levels"
4. Проверьте, что оба индикатора добавлены на график

### Параметры не совпадают

**Причина**: Разные настройки в основном индикаторе и overlay.

**Решение**: Убедитесь, что все параметры RSI и Momentum идентичны в обоих индикаторах.

## Ограничения и предостережения

1. **Запаздывание**: Индикатор основан на историческ данных и может запаздывать
2. **Ложные сигналы**: Возможны в боковых трендах и при низкой волатильности
3. **Зависимость от lookback**: Качество уровней Фибоначчи зависит от периода lookback
4. **Не является Holy Grail**: Всегда используйте дополнительный анализ и риск-менеджмент

## Технические характеристики

- **Версия Pine Script**: v6
- **Максимум линий**: 500
- **Максимум меток**: 500
- **Overlay**: false (основной индикатор), true (overlay индикатор)

## Сравнение с исходными индикаторами

### Target on Trend - Lite
- **Исходный**: Требует ручной разметки точек
- **Universal Indicator**: Автоматически определяет точки на основе RSI и объёма

### RSIV_Step
- **Исходный**: Показывает состояния RSI с гистограммой
- **Universal Indicator**: Комбинирует RSI, объём и автоматически строит Fibonacci

## Возможности кастомизации

Вы можете модифицировать код для:
- Добавления других индикаторов (MACD, Stochastic, etc.)
- Изменения количества и значений уровней Фибоначчи
- Добавления расширенных уровней (161.8%, 200%, etc.)
- Создания стратегии с автоматическими ордерами
- Добавления трендовых фильтров

## Лицензия

Этот исходный код подпадает под действие Mozilla Public License 2.0.

## Авторство

Разработано для торговой системы TRADERAGENT.

## Ссылки и ресурсы

- [Pine Script v6 Documentation](https://www.tradingview.com/pine-script-docs/en/v6/)
- [Fibonacci Retracements Guide](https://www.tradingview.com/support/solutions/43000502192-fibonacci-retracement/)
- [RSI Indicator Guide](https://www.tradingview.com/support/solutions/43000502338-relative-strength-index-rsi/)
