// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// Â© TRADERAGENT

//@version=6
indicator("Universal Indicator - Test Version", overlay=false)

// ============================================================================
// SIMPLIFIED TEST VERSION
// This version uses more relaxed conditions to trigger more frequently
// Use this to verify the indicator logic is working correctly
// ============================================================================

// Simplified inputs for testing
rsiLength = input.int(14, "RSI Length")
rsiOversold = input.int(40, "RSI Oversold (relaxed for testing)")  // Higher threshold
rsiOverbought = input.int(60, "RSI Overbought (relaxed for testing)")  // Lower threshold

// Basic calculations
rsi = ta.rsi(close, rsiLength)
rsiSmooth = ta.sma(rsi, 3)

// Simple state detection
isOversold = rsi < rsiOversold
isOverbought = rsi > rsiOverbought

// Simplified signals (no volume requirement for easier testing)
bullishSignal = ta.crossover(rsi, rsiOversold)
bearishSignal = ta.crossunder(rsi, rsiOverbought)

// Counter for signals
var int bullishCount = 0
var int bearishCount = 0

if bullishSignal
    bullishCount += 1

if bearishSignal
    bearishCount += 1

// ============================================================================
// VISUALIZATION
// ============================================================================

// Plot RSI
plot(rsi, "RSI", color=color.blue, linewidth=2)
plot(rsiSmooth, "RSI Smooth", color=color.orange, linewidth=1)

// Plot levels
hline(rsiOversold, "Oversold", color=color.green, linestyle=hline.style_dashed)
hline(50, "Midline", color=color.gray, linestyle=hline.style_dotted)
hline(rsiOverbought, "Overbought", color=color.red, linestyle=hline.style_dashed)

// Colored zones
bgcolor(isOversold ? color.new(color.green, 80) : na, title="Oversold Zone")
bgcolor(isOverbought ? color.new(color.red, 80) : na, title="Overbought Zone")

// Signal markers
plotshape(bullishSignal, "Bullish Test Signal",
         location=location.bottom, color=color.new(color.green, 0),
         style=shape.triangleup, size=size.small)

plotshape(bearishSignal, "Bearish Test Signal",
         location=location.top, color=color.new(color.red, 0),
         style=shape.triangledown, size=size.small)

// ============================================================================
// TEST DEBUG TABLE
// ============================================================================

var table testTable = table.new(position.top_right, 2, 5,
                                border_width=1,
                                border_color=color.gray,
                                frame_width=1,
                                frame_color=color.gray)

if barstate.islast
    // Header
    table.cell(testTable, 0, 0, "TEST MODE", bgcolor=color.new(color.orange, 50),
              text_color=color.white, text_size=size.normal)
    table.cell(testTable, 1, 0, "Active", bgcolor=color.new(color.orange, 50),
              text_color=color.white, text_size=size.normal)

    // RSI
    table.cell(testTable, 0, 1, "RSI", bgcolor=color.new(color.gray, 90))
    table.cell(testTable, 1, 1, str.tostring(rsi, "#.##"),
              bgcolor=isOversold ? color.new(color.green, 80) :
                      (isOverbought ? color.new(color.red, 80) : color.new(color.gray, 80)))

    // Bullish signals
    table.cell(testTable, 0, 2, "Bullish Signals", bgcolor=color.new(color.gray, 90))
    table.cell(testTable, 1, 2, str.tostring(bullishCount),
              bgcolor=bullishCount > 0 ? color.new(color.green, 80) : color.new(color.red, 80))

    // Bearish signals
    table.cell(testTable, 0, 3, "Bearish Signals", bgcolor=color.new(color.gray, 90))
    table.cell(testTable, 1, 3, str.tostring(bearishCount),
              bgcolor=bearishCount > 0 ? color.new(color.red, 80) : color.new(color.red, 80))

    // Status
    totalSignals = bullishCount + bearishCount
    statusText = totalSignals > 0 ? "Working!" : "No signals yet"
    statusColor = totalSignals > 0 ? color.new(color.green, 80) : color.new(color.orange, 80)
    table.cell(testTable, 0, 4, "Status", bgcolor=color.new(color.gray, 90))
    table.cell(testTable, 1, 4, statusText, bgcolor=statusColor)

// ============================================================================
// NOTES
// ============================================================================

// This test version should trigger signals much more frequently than the
// production version because:
// 1. Relaxed RSI thresholds (40/60 instead of 30/70)
// 2. No volume momentum requirement
// 3. No RSI slope requirement
//
// If you see signals in this test version but not in the production version,
// that means the production logic is working correctly but conditions are
// stricter (which is by design).
//
// If you see NO signals even in this test version, check:
// - The asset has enough price movement
// - You're looking at enough historical data
// - RSI is actually oscillating across the thresholds
