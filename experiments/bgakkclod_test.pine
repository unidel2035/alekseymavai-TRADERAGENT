// This source code is subject to the terms of the Mozilla Public License 2.0 at https://mozilla.org/MPL/2.0/
// © TRADERAGENT

//@version=6
indicator("BGAKKCLOD Test - Simplified Signal Detection", shorttitle="BGAKKCLOD Test", overlay=true, max_lines_count=100)

// ============================================================================
// SIMPLIFIED TEST VERSION
// ============================================================================
// This is a simplified version of BGAKKCLOD for testing signal detection
// Triggers more frequently with relaxed conditions
//
// Упрощенная тестовая версия BGAKKCLOD для проверки определения сигналов
// Срабатывает чаще с более мягкими условиями

// === Basic Settings ===
rsiLength = input.int(14, "RSI Period", minval=1)
rsiOversold = input.int(35, "Oversold (relaxed)", minval=1, maxval=50)
rsiOverbought = input.int(65, "Overbought (relaxed)", minval=50, maxval=100)

// === RSI Calculation ===
rsi = ta.rsi(close, rsiLength)
rsiSmooth = ta.sma(rsi, 3)

// === Simple Candle Detection ===
isBullishCandle = close > open
isBearishCandle = close < open

candleBody = math.abs(close - open)
candleRange = high - low
hasBody = candleBody > (candleRange * 0.3)

// === Relaxed Signal Conditions ===
// Bullish: RSI < oversold threshold + bullish candle with body
bullishSignal = rsi < rsiOversold and isBullishCandle and hasBody

// Bearish: RSI > overbought threshold + bearish candle with body
bearishSignal = rsi > rsiOverbought and isBearishCandle and hasBody

// === Counter for debugging ===
var int bullishCount = 0
var int bearishCount = 0

if bullishSignal
    bullishCount += 1

if bearishSignal
    bearishCount += 1

// === Visual Markers ===
plotshape(
     bullishSignal,
     title="Test Bullish",
     location=location.belowbar,
     color=color.new(color.lime, 0),
     style=shape.triangleup,
     size=size.small,
     text="TEST\nBUY"
 )

plotshape(
     bearishSignal,
     title="Test Bearish",
     location=location.abovebar,
     color=color.new(color.red, 0),
     style=shape.triangledown,
     size=size.small,
     text="TEST\nSELL"
 )

// === Simple Fibonacci Levels ===
var line testLine1 = na
var line testLine2 = na
var label testLabel = na

if bullishSignal
    // Delete old lines
    if not na(testLine1)
        line.delete(testLine1)
    if not na(testLine2)
        line.delete(testLine2)
    if not na(testLabel)
        label.delete(testLabel)

    // Draw simple Fibonacci levels
    swingLow = ta.lowest(low, 50)
    swingHigh = ta.highest(high, 50)
    fib50 = swingLow + (swingHigh - swingLow) * 0.5
    fib618 = swingLow + (swingHigh - swingLow) * 0.618

    testLine1 := line.new(bar_index, fib50, bar_index + 10, fib50,
        color=color.new(color.yellow, 0), width=2)

    testLine2 := line.new(bar_index, fib618, bar_index + 10, fib618,
        color=color.new(color.green, 0), width=2)

    testLabel := label.new(bar_index, fib50, "Test Fib 50%",
        style=label.style_label_left,
        color=color.new(color.yellow, 70),
        textcolor=color.white,
        size=size.small)

if bearishSignal
    // Delete old lines
    if not na(testLine1)
        line.delete(testLine1)
    if not na(testLine2)
        line.delete(testLine2)
    if not na(testLabel)
        label.delete(testLabel)

    // Draw simple Fibonacci levels
    swingLow = ta.lowest(low, 50)
    swingHigh = ta.highest(high, 50)
    fib50 = swingLow + (swingHigh - swingLow) * 0.5
    fib382 = swingLow + (swingHigh - swingLow) * 0.382

    testLine1 := line.new(bar_index, fib50, bar_index + 10, fib50,
        color=color.new(color.orange, 0), width=2)

    testLine2 := line.new(bar_index, fib382, bar_index + 10, fib382,
        color=color.new(color.red, 0), width=2)

    testLabel := label.new(bar_index, fib50, "Test Fib 50%",
        style=label.style_label_left,
        color=color.new(color.orange, 70),
        textcolor=color.white,
        size=size.small)

// === Debug Table ===
var table debugTable = table.new(position.top_right, 2, 5, border_width=1)

if barstate.islast
    // Header
    table.cell(debugTable, 0, 0, "BGAKKCLOD TEST",
        bgcolor=color.new(color.purple, 50),
        text_color=color.white,
        text_size=size.normal)
    table.cell(debugTable, 1, 0, "Value",
        bgcolor=color.new(color.purple, 50),
        text_color=color.white,
        text_size=size.normal)

    // Bullish signals count
    table.cell(debugTable, 0, 1, "Bullish Signals",
        bgcolor=color.new(color.gray, 70),
        text_size=size.small)
    table.cell(debugTable, 1, 1, str.tostring(bullishCount),
        bgcolor=bullishCount > 0 ? color.new(color.green, 70) : color.new(color.red, 70),
        text_color=color.white,
        text_size=size.small)

    // Bearish signals count
    table.cell(debugTable, 0, 2, "Bearish Signals",
        bgcolor=color.new(color.gray, 70),
        text_size=size.small)
    table.cell(debugTable, 1, 2, str.tostring(bearishCount),
        bgcolor=bearishCount > 0 ? color.new(color.green, 70) : color.new(color.red, 70),
        text_color=color.white,
        text_size=size.small)

    // Current RSI
    table.cell(debugTable, 0, 3, "Current RSI",
        bgcolor=color.new(color.gray, 70),
        text_size=size.small)
    rsiColor = rsi < rsiOversold ? color.new(color.green, 70) :
               rsi > rsiOverbought ? color.new(color.red, 70) :
               color.new(color.gray, 80)
    table.cell(debugTable, 1, 3, str.tostring(math.round(rsi, 1)),
        bgcolor=rsiColor,
        text_color=color.white,
        text_size=size.small)

    // Status
    table.cell(debugTable, 0, 4, "Status",
        bgcolor=color.new(color.gray, 70),
        text_size=size.small)
    status = bullishCount + bearishCount > 0 ? "WORKING ✓" : "WAITING..."
    statusColor = bullishCount + bearishCount > 0 ? color.new(color.green, 70) : color.new(color.orange, 70)
    table.cell(debugTable, 1, 4, status,
        bgcolor=statusColor,
        text_color=color.white,
        text_size=size.small)

// ============================================================================
// NOTES
// ============================================================================
// This test version should trigger more frequently than the main indicator
// If you see signals here, the drawing mechanism works correctly
// The main indicator has stricter conditions by design
